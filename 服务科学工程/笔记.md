# 第三章 服务构件与服务组合
## 服务构件
### 一、服务要素与服务构件
**服务要素**：人、技术、共享信息
服务要素可组合，形成**复合要素**
#### 虚拟化
按原则，将非软件化的服务要素 以**软件化形式**体现，设计访问接口，然后Web服务发布，使IT服务系统与业务服务**一致**
#### 基于SCA的服务系统
服务系统 == 服务集合
SCA System由多个子系统SubSystem和多个模块Modules组合
##### 服务子系统SubSystem
可组合外部服务，组合模块组件，形成服务的入口点
##### 服务模块Module
装配了Components、 External Services、 Entry Points
**特性**：
1. 内部组件不能被外部模块直接引用
2. 内组件通讯采用Local方式，模块间组件通讯采用Remote方式
3. 部署单元，业务逻辑工件(artifacts)组装
##### 服务模块构件Module Component
这里module component指的只是module的配置后的实例，module是一个有功能的接口，但是没配置，部署起来可以直接用就是module component
通过Entry Points可以绑定外部服务或与其他模块或服务等通信，也可以作为外部服务被调用访问
##### SCA构件Component
同上，是作为SCA的配置实例，实现了构件的某些接口
暴露接口，为Java或WSDL，可供调用
##### 服务构件Service Component
**定义**：服务构件架构SCA中的基本组成元素和基本构建单位， 是具体实现业务逻辑的基本单元。 它是SCA中紧耦合组合的“最大组织单元” ， 也是松耦合组合的“基本组织单元
**作用**：将服务要素进行全面描述并统一封装，以便于进行选取、重用与组合
![[Pasted image 20241109084227.png]]
#### SCA
**思想**：把业务功能作为一系列服务组封装在一起，以满足特定的业务需求
**作用**：为组合服务，重用服务和创建服务构件（组件）提供了一种模型。
**定义**：SCA是一种基于服务的模型，用来构建SOA应用程序和解决方案，组合和部署新的或已存在的服务
**特性**：SOA的本质特性在于可以通过组合新的或已存在的服务来创建新的应用服务，而这些组成新服务的原子服务可以由不同的技术来开发实现
#### 服务构件描述
##### WSDL
基本信息和接口信息
##### OWL-S
还包括功能语义
使用一系列基本类和属性来描述Web 服务
#### 服务构件要素
用户交互，调用，组合，业务构件（业务逻辑经过封装构建，有接口和实现），数据和信息
这些服务构件要素可以通过不同的服务构件实现
![[Pasted image 20241109085216.png]]
### 二、服务构件类型及模型
#### Web Service Web服务
Web服务的基本协议 ：WSDL统一服务接口描述，UDDI通用描述和发现接口规范，SOAP统一数据传输和交换格式，HTTP传输
##### Web服务体系结构
发现订阅那一套
![[Pasted image 20241109090827.png]]
##### WSHumanTask、BPEL4People
人工活动虚拟化，异步执行
BPEL扩展为同时支持对Web服务和基于角色的人工活动进行编排
##### REST
**无状态**，轻量，用于调用服务（但一切都被抽象为资源），每个资源都有**唯一资源标识符**，任何操作无状态**不改变资源标识符**，但针对不同服务使用者有不同的具体表示状态
提供接口给外部世界，并且提供操作服务（GET，POST等）
#### 服务构件体系结构SCA
**概念**：编程模型，能方便快速地构建服务系统和应用
**基本组成**：构件是SCA中的基本组成元素和基本构建单位
**接口**：基于WSDL或Java的规范
##### 构件的元素和模型
![image.png](https://s2.loli.net/2024/11/09/KEPgbGvJM3Fy5h6.png)

左侧是该构件实现的功能（提供的**服务**），右侧是**引用**的其他服务或程序
他们可以**绑定**其他服务，体现出交互通信
构件具有**属性**，可能也会同时配置给一些内部的基础服务，内部服务遵循以上模型
##### 构件机制
内部通过业务逻辑组件运作，这些业务组件可以调用外部服务和数据，并且可作为外部服务和数据供外部调用（**双向的**），
##### SCA的实现
各种语言都可以
##### SCA服务模块
是SCA的**运行单位**，由许多有业务联系的SCA构件组成并部署，一般来说能满足一个完整的服务需求
##### SDO服务数据对象
异构数据源的抽象层，统一方式规范数据接入，支持通用数据操作
基本要素：以**数据对象**为核心进行操作和存储，其指向**元数据**，提供元数据API。数据对象的集合形成**数据图**，可记录历史操作。以上操作通过**数据中介服务**实现
##### WS-Resource服务资源
**概念**：对一个有状态资源(数据库、物理资源等)和它与之交互的 Web 服务的组合
WS本身是无状态的，但结合**有状态**资源，就变成了Web服务资源。
服务资源拥有**ERP**（End-Point Reference），**唯一的**关联一个Web服务和一套引用属性。服务资源可通过多个接口来拥有多个ERP，**关联多个Web服务**。
资源创建后**分配一个ERP**，并具有生命周期
有状态资源的**状态数据**是资源属性文件，供使用者查看
##### WSLA Web服务等级协议
SLA由双方定义，应该满足什么需求，规范操作等。用到Web服务上就是
**概念**：定义Web服务的质量 QoS参数及其度量，用于自动监控与度量运行时的服务质量
**要素**：参与者、服务定义、义务、协议
### 三、SCA模型
**概念**：SCA是一种基于服务的模型，用来构建SOA应用程序和解决方案，组合和部署新的或已存在的服务
**思想**：把业务功能作为一系列服务组封装在一起，以满足特定的业务需求
**作用**：为组合服务，重用服务和创建服务构件（组件）提供了一种模型。
**特性**：SOA的本质特性在于可以通过组合新的或已存在的服务来创建新的应用服务，而这些组成新服务的原子服务可以由不同的技术来开发实现
#### 特点
**高度可扩展性**，**语言中立**，把**基础设施功能**（数据库，具体语言实现和接口，对其他服务的操作）从业务领域**分离**，使开发者精力集中在业务逻辑上
**不同粒度的服务**，采用**递归复用模式**实现不同粒度服务的重用
**不同的“绑定”方式**，实现服务间的通信
#### SCA的服务组合
实现构件（自己提供的和外部别人的），服务组合（以SCA模式进行引用和组装）
#### SCA域
服务的组合，单一组织控制的业务功能域（集合）。由多个SCA构件(Composite)组成，SCA构件是由之前提到的Component组成
#### SCA运行态
SCA域中的服务或引用绑定到具体的容器进行操作
## 服务发现
**定义**：根据用户在功能和非功能方面对目标服务的**需求及约束**，通过**服务发现算法**自动从**服务注册中心**查找到满足用户需求和约束的**服务与服务集合**
**特点**：只需要通过服务的名字查询使用，无需了解架构的部署拓扑环境
可以基于关键字或语义检索
### 服务注册
**定义**：服务实例将自身服务信息注册到注册中心，包括服务所在主机IP和提供服务的端口Port，还有身份验证信息、协议、版本号、以及运行环境等信息
### 服务发现机制
**服务提供者**： 服务启动时将服务信息注册到注册中心，服务退出时将注册中心的服务信息删除掉。
**服务消费者**： 从服务注册表获取服务提供者的最新网络位置等服务信息，维护与服务提供者之间的通信。
**注册中心**： 提供管理和查询服务注册信息的API。当服务提供者的实例发生变更时（新增/删除服务），服务注册表更新最新的状态列表，并将其最新列表以适当的方式通知给服务消费者。
### 服务发现方式
**客户端发现**： 客户端通过查询服务注册中心，获取可用的服务的实际网络地址（IP 和端口）；然后，根据调用端本地的负载均衡策略，进行服务调用，并将请求发送至该服务
**服务器端发现**： 服务调用方直接向服务注册中心进行请求，服务注册中心再通过自身负载均衡策略，负载均衡器查询到可用的服务，进行服务调用；然后，转发请求到该服务上
### 服务发现过程
1.根据服务请求进行服务发现的描述 2.依据服务匹配算法进行服务查找和服务匹配 3.进行服务选择与排序 4.确定最佳服务
### 服务发现问题
服务描述及语义： 准确、细致刻画服务的属性
服务准备与部署： 有效地进行服务的准备，采取有效服务部署策略
服务匹配算法： 研究有效的服务匹配算法，以便提高服务发现的查准率
服务选择与排序： 研究有效的服务选择策略与排序算法
服务发现方法： 针对不同QoS约束，研究各种优化的服务发现策略与方法
还有性能，效率，多样性问题
### 服务发现的架构
集中式：服务注册中心，各服务的描述信息均注册并存放于此服务请求者向其发出**查询**，返回结果
代理式： 采用服务代理处，各服务的描述信息存放于此，服务请求者与服务提供者通过**代理交互**
分布式： 利用P2P网络或云计算环境分布Web服务注册站点，**探察各Web服务**提供站点
非注册式： 不对服务进行注册，而采用直接收索方式
### 服务发现方法
语法级服务发现：基于服务注册信息的关键字和部分属性进行服务描述
语义级服务发现： 借助于服务描述的本体语义信息和逻辑推理服务匹配功能
#### 语义服务发现过程
1. **自动发现**：服务提供者采用**OWL-S**对服务语义的描述，服务请求者可以通过服务语义信息查找并发现满足其功能需求和分类标准、质量要求等评价标准的服务
2. **自动执行**：服务请求者可通过服务语义信息自动选择服务，并根据一些复杂任务的要求对服务进行自动服务组合
3. **自动监控**：通过服务语义信息，使得服务请求者可以自动监控单个服务或者组合服务的执行
## 服务组合
**概念**：针对用户服务需求，根据一定的业务规则，选择恰当的服务集合并组织起来形成一个**更大粒度的、具有内部流程逻辑的有序服务集**，并能够满足实现更大业务目标、服务功能、 QoS和价值等方面的需求
### 服务组合过程
规划阶段： 发现候选服务，检测其服务组合的**可用性与一致性**，并提供多个候选服务组合规划
定义阶段： 在候选服务组合规划中选择并生成实际的**服务组合结构**，并提供一个服务组合的**语义规范**
实施阶段： 根据服务组合规范来**绑定**组合的服务，使这些服务能够协同工作以满足相应的任务或功能
### 服务组合方法
#### 服务编排
需要一个总控流程来控制相关Web服务，并协调Web服务各个操作的执行
#### 服务协同
并不依赖中央总控协调， 各Web服务知道何时执行自己的操作和与谁交互
#### 业务流程驱动的服务组合
以业务流程为基础，通过业务流程建模为业务流程中的每个活动分别选择和绑定服务，从而形成一个流程式的组合服务。
**静态服务组合**： 在建模阶段，人为地为每个活动选取某一个具体服务；在服务组
**基于模板的服务组合过程**：
合执行阶段，执行引擎根据与活动绑定的具体服务，进行参数传递和服务调用
## 服务选择
**概念**：在符合功能需求的众多服务/服务组合方案中，选择并获取满足非功能需求的高质量服务解决方案，其中，服务质量**QoS**(Quality of Services)是一个重要的考量
**关键问题**： 如何从大量功能相同但全局QoS不同的组合服务中选择满足用户QoS需求的服务组合方案
**过程**：为抽象服务查找满足功能需求的实体服务，从候选服务集中选择满足非功能需求的服务。先是通过优化算法寻求满足局部与全局约束条件的可行解，再通过排序选择最优服务解决方案
### QoS感知的动态服务选择
**概念**：服务组合的灵活性，软件服务设计阶段，只**描述应用所需要的功能**，服务运行阶段，不同的用户会**根据不同的QoS需求绑定具体的服务**
### 基于服务功能规约的服务选择
将若干功能相关的抽象服务合并为粒度更大的抽象服务，只基于规约后的大粒度抽象服务进行绑定，有效缩减候选服务规模
1）服务功能规约将功能相关的抽象服务规约（合并）为一个粒度更大的抽象服务。
2）对合并后的抽象服务组合实施组合优化
若抽象服务间存在**多种规约方案**，则需对方案**分别进行组合优化**。每种规约方案都对应一组**最优非劣解集合**，每个解即是由若干具体服务组合而成的组合服务。
3）通过最优非劣解集合的合并和排序得到最终的最优非劣解集合
最优非劣解集合中的每个解所对应的服务组合都能满足用户的功能需求，且其QoS是最优非劣的，用户可根据实际需要选择其中的一个解进行服务绑定。
