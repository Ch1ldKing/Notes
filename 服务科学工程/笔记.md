# 第三章 服务构件与服务组合
## 服务构件
### 一、服务要素与服务构件
**服务要素**：人、技术、共享信息
服务要素可组合，形成**复合要素**
#### 虚拟化
按原则，将非软件化的服务要素 以**软件化形式**体现，设计访问接口，然后Web服务发布，使IT服务系统与业务服务**一致**
#### 基于SCA的服务系统
服务系统 == 服务集合
SCA System由多个子系统SubSystem和多个模块Modules组合
##### 服务子系统SubSystem
可组合外部服务，组合模块组件，形成服务的入口点
##### 服务模块Module
装配了Components、 External Services、 Entry Points
**特性**：
1. 内部组件不能被外部模块直接引用
2. 内组件通讯采用Local方式，模块间组件通讯采用Remote方式
3. 部署单元，业务逻辑工件(artifacts)组装
##### 服务模块构件Module Component
这里module component指的只是module的配置后的实例，module是一个有功能的接口，但是没配置，部署起来可以直接用就是module component
通过Entry Points可以绑定外部服务或与其他模块或服务等通信，也可以作为外部服务被调用访问
##### SCA构件Component
同上，是作为SCA的配置实例，实现了构件的某些接口
暴露接口，为Java或WSDL，可供调用
##### 服务构件Service Component
**定义**：服务构件架构SCA中的基本组成元素和基本构建单位， 是具体实现业务逻辑的基本单元。 它是SCA中紧耦合组合的“最大组织单元” ， 也是松耦合组合的“基本组织单元
**作用**：将服务要素进行全面描述并统一封装，以便于进行选取、重用与组合
![[Pasted image 20241109084227.png]]
#### SCA
**思想**：把业务功能作为一系列服务组封装在一起，以满足特定的业务需求
**作用**：为组合服务，重用服务和创建服务构件（组件）提供了一种模型。
**定义**：SCA是一种基于服务的模型，用来构建SOA应用程序和解决方案，组合和部署新的或已存在的服务
**特性**：SOA的本质特性在于可以通过组合新的或已存在的服务来创建新的应用服务，而这些组成新服务的原子服务可以由不同的技术来开发实现
#### 服务构件描述
##### WSDL
基本信息和接口信息
##### OWL-S
还包括功能语义
使用一系列基本类和属性来描述Web 服务
#### 服务构件要素
用户交互，调用，组合，业务构件（业务逻辑经过封装构建，有接口和实现），数据和信息
这些服务构件要素可以通过不同的服务构件实现
![[Pasted image 20241109085216.png]]
### 二、服务构件类型及模型
#### Web Service Web服务
Web服务的基本协议 ：WSDL统一服务接口描述，UDDI通用描述和发现接口规范，SOAP统一数据传输和交换格式，HTTP传输
##### Web服务体系结构
发现订阅那一套
![[Pasted image 20241109090827.png]]
##### WSHumanTask、BPEL4People
人工活动虚拟化，异步执行
BPEL扩展为同时支持对Web服务和基于角色的人工活动进行编排
##### REST
**无状态**，轻量，用于调用服务（但一切都被抽象为资源），每个资源都有**唯一资源标识符**，任何操作无状态**不改变资源标识符**，但针对不同服务使用者有不同的具体表示状态
提供接口给外部世界，并且提供操作服务（GET，POST等）
#### 服务构件体系结构SCA
**概念**：编程模型，能方便快速地构建服务系统和应用
**基本组成**：构件是SCA中的基本组成元素和基本构建单位
**接口**：基于WSDL或Java的规范
##### 构件的元素和模型
![image.png](https://s2.loli.net/2024/11/09/KEPgbGvJM3Fy5h6.png)

左侧是该构件实现的功能（提供的**服务**），右侧是**引用**的其他服务或程序
他们可以**绑定**其他服务，体现出交互通信
构件具有**属性**，可能也会同时配置给一些内部的基础服务，内部服务遵循以上模型
##### 构件机制
内部通过业务逻辑组件运作，这些业务组件可以调用外部服务和数据，并且可作为外部服务和数据供外部调用（**双向的**），
##### SCA的实现
各种语言都可以
##### SCA服务模块
是SCA的**运行单位**，由许多有业务联系的SCA构件组成并部署，一般来说能满足一个完整的服务需求
##### SDO服务数据对象
异构数据源的抽象层，统一方式规范数据接入，支持通用数据操作
基本要素：以**数据对象**为核心进行操作和存储，其指向**元数据**，提供元数据API。数据对象的集合形成**数据图**，可记录历史操作。以上操作通过**数据中介服务**实现
##### WS-Resource服务资源
**概念**：对一个有状态资源(数据库、物理资源等)和它与之交互的 Web 服务的组合
WS本身是无状态的，但结合**有状态**资源，就变成了Web服务资源。
服务资源拥有**ERP**（End-Point Reference），**唯一的**关联一个Web服务和一套引用属性。服务资源可通过多个接口来拥有多个ERP，**关联多个Web服务**。
资源创建后**分配一个ERP**，并具有生命周期
有状态资源的**状态数据**是资源属性文件，供使用者查看
##### WSLA Web服务等级协议
SLA由双方定义，应该满足什么需求，规范操作等。用到Web服务上就是
**概念**：定义Web服务的质量 QoS参数及其度量，用于自动监控与度量运行时的服务质量
**要素**：参与者、服务定义、义务、协议
### 三、SCA模型
**概念**：SCA是一种基于服务的模型，用来构建SOA应用程序和解决方案，组合和部署新的或已存在的服务
**思想**：把业务功能作为一系列服务组封装在一起，以满足特定的业务需求
**作用**：为组合服务，重用服务和创建服务构件（组件）提供了一种模型。
**特性**：SOA的本质特性在于可以通过组合新的或已存在的服务来创建新的应用服务，而这些组成新服务的原子服务可以由不同的技术来开发实现
#### 特点
**高度可扩展性**，**语言中立**，把**基础设施功能**（数据库，具体语言实现和接口，对其他服务的操作）从业务领域**分离**，使开发者精力集中在业务逻辑上
**不同粒度的服务**，采用**递归复用模式**实现不同粒度服务的重用
**不同的“绑定”方式**，实现服务间的通信
#### SCA的服务组合
实现构件（自己提供的和外部别人的），服务组合（以SCA模式进行引用和组装）
#### SCA域
服务的组合，单一组织控制的业务功能域（集合）。由多个SCA构件(Composite)组成，SCA构件是由之前提到的Component组成
#### SCA运行态
SCA域中的服务或引用绑定到具体的容器进行操作
## 服务发现
**定义**：根据用户在功能和非功能方面对目标服务的**需求及约束**，通过**服务发现算法**自动从**服务注册中心**查找到满足用户需求和约束的**服务与服务集合**
**特点**：只需要通过服务的名字查询使用，无需了解架构的部署拓扑环境
可以基于关键字或语义检索
### 服务注册
**定义**：服务实例将自身服务信息注册到注册中心，包括服务所在主机IP和提供服务的端口Port，还有身份验证信息、协议、版本号、以及运行环境等信息
### 服务发现机制
**服务提供者**： 服务启动时将服务信息注册到注册中心，服务退出时将注册中心的服务信息删除掉。
**服务消费者**： 从服务注册表获取服务提供者的最新网络位置等服务信息，维护与服务提供者之间的通信。
**注册中心**： 提供管理和查询服务注册信息的API。当服务提供者的实例发生变更时（新增/删除服务），服务注册表更新最新的状态列表，并将其最新列表以适当的方式通知给服务消费者。
### 服务发现方式
**客户端发现**： 客户端通过查询服务注册中心，获取可用的服务的实际网络地址（IP 和端口）；然后，根据调用端本地的负载均衡策略，进行服务调用，并将请求发送至该服务
**服务器端发现**： 服务调用方直接向服务注册中心进行请求，服务注册中心再通过自身负载均衡策略，负载均衡器查询到可用的服务，进行服务调用；然后，转发请求到该服务上
### 服务发现过程
根据服务请求进行服务发现的描述。依据服务匹配算法进行

服务查找和服务匹配。

③ 进行服务选择与排序。

④ 确定最佳服务。