### 3.1 内存管理概述

Intel 64和IA-32架构的内存管理分为两部分：段机制（Segmentation）和分页机制（Paging）。

- 段机制：通过将程序的代码、数据和栈划分为不同的段，确保多任务运行时彼此不会干扰。
- 分页机制：实现基于虚拟内存的系统，支持大于物理内存的线性地址空间，并提供隔离。
### 3.2 使用段机制

#### 3.2.1 基本平坦模型 (Flat Model)
- 在平坦模型中，操作系统和应用程序共享一个连续的、无分段的地址空间。
- 所有段的基地址设为0，段限值为4GB，使得分段机制不会因为内存越界而抛出异常。
#### 3.2.2 受保护的平坦模型 (Protected Flat Model)
 通过将段限值设置为物理内存实际存在的范围，对不存在的内存访问抛出#GP异常。增加复杂度后，可以定义用户态和内核态的代码和数据段来实现更高的隔离性。
#### 3.2.3 多段模型 (Multi-Segment Model)

- 每个程序或任务拥有自己的段描述符表和段。段可以是私有的或共享的。
- 硬件会强制执行访问检查，确保一个任务无法写入另一个任务的代码段或数据段。
- 该模型也支持访问权限检查和特权级别，保护操作系统免受应用程序的非法访问。
模型分类
1. 基本平坦模型：
    所有代码和数据段覆盖整个线性地址空间，基地址为0，限值为4GB。
2. 受保护平坦模型：
    段限值缩小到实际物理内存的大小，提供基本的硬件保护。
3. 多段模型：
    不同的程序或任务使用自己的段描述符和段寄存器，实现隔离和访问控制。
---

### 3.2.4 IA-32e模式中的分段机制

- 兼容模式 (Compatibility Mode)：分段机制与32位模式类似，保持向后兼容。
- 64位模式 (64-bit Mode)：分段机制被大部分禁用，创建平坦的64位线性地址空间。
    - FS和GS段寄存器仍可用于地址计算，有助于操作系统访问局部数据结构。
    - 段限值检查在64位模式下被禁用。

---

### 3.2.5 分页与分段的结合

- 分页机制可与任何分段模型（平坦模型或多段模型）结合使用。
- 分页机制将线性地址空间分为多个页面，并映射到物理地址空间中的页面。
- 页面级保护：支持基于页面的读写保护和用户/超级用户权限，补充或替代段保护。

---
